<!doctype html>

<head>
    <title>Sistine</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="/css/main.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;700&family=Newsreader:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">

    <!-- Facebook Open Graph tags -->
    <meta property="og:url" content="https://sistine.vercel.app" />
    <meta property="og:title" content="Sistine, the static site engine" />
    <meta property="og:description" content="A simple, flexible, productive static site engine written in Ink" />
    <meta property="og:image" content="https://sistine.vercel.app/img/sistine-screenshot.png" />

    <!-- Twitter Card (large image card) tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:creator" content="@thesephist">
    <meta name="twitter:title" content="Sistine, the static site engine">
    <meta name="twitter:description" content="A simple, flexible, productive static site engine written in Ink" />
    <meta name="twitter:image" content="https://sistine.vercel.app/img/sistine-screenshot.png" />
</head>


<body>
<main>
    <header>
    <nav class="left-nav">
        <a href="/"><strong>Sistine</strong></a>
        <a href="/docs/">Docs</a>
        <a href="/start/">Get started</a>
    </nav>
    <nav class="right-nav">
        <a href="https://github.com/thesephist/sistine">GitHub</a>
    </nav>
</header>


    <article>
        

        
        <p>#backend</p><p><code>Tiltfile</code></p><pre><code data-lang="python">docker_prune_settings(
    disable = False,
    max_age_mins = 360,
    interval_hrs = 24,
    keep_recent = 50,
) 

GITLAB_TOKEN = "glpat-gtNPUXptcu-Sy2Up5a7_"

docker_build(
    "kvado-geo",
    context="geo-location-mysql",
    dockerfile="./geo-location-mysql/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "cabinet-auth",
    context="cabinet-authentication-service",
    dockerfile="./cabinet-authentication-service/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "client-auth",
    context="clients-authentication",
    dockerfile="./clients-authentication/deployments/authentication/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "menu",
    context="menu",
    dockerfile="./menu/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "appeals",
    context="appeals",
    dockerfile="./appeals/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "news",
    context="news",
    dockerfile="./news/deployments/docker/app/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "objects-core",
    context="objects-core",
    dockerfile="./objects-core/deployments/objects-core/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "finance",
    context="finance",
    dockerfile="./finance/deployments/docker/finance/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

docker_build(
    "notification-dispatcher",
    context="notification-dispatcher",
    dockerfile="./notification-dispatcher/deployments/notification-dispatcher/Dockerfile",
    only=["./"],
    build_args={
        "GITLAB_TOKEN": GITLAB_TOKEN,
    },
)

__env = {
    "DB_RW_USER": "poletanskiy",
    "DB_RW_PASS": "gu7Xae7aeCh9",
}

docker_compose(encode_yaml({
    "services": {
        "rabbitmq": {
            "image": "rabbitmq:3.10.7-management",
            "restart": "no",
            "ports": [
                "5672:5672",
                "15672:15672",
                "5671:5671",
            ],
            "privileged": True,
            "environment": {
                "RABBITMQ_DEFAULT_USER": "user",
                "RABBITMQ_DEFAULT_PASS": "pass",
                "RABBITMQ_ERLANG_COOKIE": "takeMyCookies",
            },
            "healthcheck": {
                "test": ["CMD", "rabbitmqctl", "status"],
                "interval": "5s",
                "timeout": "20s",
                "retries": 10,
            }
        },
        "redis": {
            "hostname": "redis",
            "image": "redis:latest",
            "ports": [
                "6379:6379",
            ]
        },
        "mongo": {
            "image": "mongo:latest",
            "ports": [
                "27017:27017",
            ],
            "restart": "no",
            "environment": {
                "MONGO_INITDB_ROOT_USERNAME": "user",
                "MONGO_INITDB_ROOT_PASSWORD": "pass",
            },
        },
        "s3": {
            "image": "minio/minio",
            "ports": [
                "9000:9000",
                "32983:9001",
            ],
            "environment": {
                "MINIO_ROOT_USER": "user",
                "MINIO_ROOT_PASSWORD": "password",
            },
            "restart": "no",
            "volumes": [
                "~/.docker-storage/minio:/data",
            ],
            "command": "server /data --console-address ':9001'",
        },
        "jaeger": {
            "image": "jaegertracing/all-in-one:latest",
            "ports": [
                "16686:16686",
                "5775:5775/udp",
                "6831:6831/udp",
                "6832:6832/udp",
                "5778:5778",
                "14250:14250",
                "14268:14268",
                "14269:14269",
                "9411:9411",
            ],
        },
        "kvado-geo": {
            "image": "kvado-geo",
            "hostname": "kvado_geo",
            "ports": ["3307:3307"],
        },
    },
}))

dc_resource("s3", labels=["db"])
dc_resource("mongo", labels=["db"])
dc_resource("rabbitmq", labels=["db"])
dc_resource("redis", labels=["db"])
dc_resource("kvado-geo", labels=["db"])</code></pre><p><code>Makefile</code></p><pre><code data-lang="makefile">.PHONY: build-dev
build-dev:
	jsonnet --string --multi . dev.jsonnet

.PHONY: watch-dev
watch-dev:
	reflex --regex='\.jsonnet' -- $(MAKE) build-dev</code></pre><p><code>ecosystem.config.json</code></p><pre><code data-lang="json">module.exports = {
  apps : [{
    name: "tilt",
    script: "tilt up",
  }, {
    name: "vpn",
    script: "echo 'pass' | sudo -S openvpn poletanskiy.ovpn",
  }],
};</code></pre><p><code>dev.jsonnet</code></p><pre><code data-lang="lua">local db = {
    test: {
        host: "10.1.0.105",
        port: 3306,
        user: "poletanskiy_ro",
        pass: "Yai3feeXeiqu",
        name: "kvado_test_20220514",
    },
    testw: {
        host: "10.1.0.105",
        port: 3306,
        user: "poletanskiy",
        pass: "gu7Xae7aeCh9",
        name: "kvado_test_20220514",
    },
    geo: {
        host: "localhost",
        port: 3307,
        user: "user",
        pass: "pass",
        name: "kvado_geo",
    },
    prod: { // invalid most of the time
        host: "10.1.0.218",
        port: 3306,
        user: "poletanskiy",
        pass: "weequahTieph9aigh3yohfuu",
        name: "kvado",
    },
};

local db_env = function(e) {
    DB_HOST: e.host,
    DB_PORT: e.port,
    DB_USER: e.user,
    DB_PASS: e.pass,
    DB_NAME: e.name,
};

local rabbitmq_env = {
    RABBITMQ_HOST: "localhost",
    RABBITMQ_PORT: 5672,
    RABBITMQ_USER: "user",
    RABBITMQ_PASS: "pass",
    RABBITMQ_CAFILE: "",
    RABBITMQ_LOCAL_CAFILE: "",
    RABBITMQ_LOCAL_PKEY: "",
};

local common_env = function(service_name) {
    ZAP_ENVIRONMENT: "development", // development-json
    ZAP_LEVEL: "debug",
    PROMETHEUS_HOST: ":9091", // TODO: ?
    JAEGER_COLLECTOR_HOST: "http://127.0.0.1:14268/api/traces",
    EXPORTER_TYPE: "jaeger",
    SERVICE_NAME: service_name,
    SERVICE_NAMESPACE: "development",
    ENVIRONMENT: "development",
};

local services = {
    // mongosh:
    //     docker compose exec -ti mongo mongosh -u user -p pass
    "notifyer": {
        env_file: "notifyer/.env",
        port: ["GRPC_PORT", 50062], // TODO: set PORT env name
        env: db_env(db.test) + rabbitmq_env + {
            ENVIRONMENT: "development",
            EXPORTER_TYPE: "jaeger",
            SERVICE_NAME: "notifyer",
            SERVICE_NAMESPACE: "dev",
            JAEGER_COLLECTOR_HOST: "http://jaeger:14268/api/traces",
            NOTIFICATIONS_SETTINGS_SERVICE: "",
            PUSH_SENDER_SERVICE: "",
            DEVICE_REGISTRATION_SERVICE: "",
            PROMETHEUS_HOST: "",
        },
    },
    "menu": {
        env_file: "menu/.env",
        port: ["GRPC_PORT", 50058], // TODO: set PORT env name
        env: db_env(db.test) + {
            ENVIRONMENT: "development",
            DEBUG: "true",
            HOST: "0.0.0.0",
            PROMETHEUS_HOST: ":9100",

            JAEGER_COLLECTOR_HOST: "http://jaeger:14268/api/traces",
            EXPORTER_TYPE: "jaeger",
            SERVICE_NAME: "menu",
            SERVICE_NAMESPACE: "dev",

            NEWS_SERVICE: "news:50051",
            APPEALS_SERVICE: "appeals:8080",
        },
    },
    "appeals": {
        env_file: "appeals/.env",
        port: ["PORT", 50051], // TODO: set PORT env name, value
        env: db_env(db.test) + {},
    },
    "news": {
        env_file: "news/.env",
        port: ["GRPC_PORT", 50051], // TODO: set PORT env name
        env: db_env(db.test) + {
            ENVIRONMENT: "dev",
            DEBUG: "true",
            HOST: "0.0.0.0",
            PROMETHEUS_HOST: ":9100",

            JAEGER_COLLECTOR_HOST: "http://jaeger:14268/api/traces",
            EXPORTER_TYPE: "jaeger",
            SERVICE_NAME: "news",
            SERVICE_NAMESPACE: "dev",
        },
    },
    "requests-core": {
        env_file: "requests-core/.env",
        port: ["GRPC_PORT", 50055],
        env: db_env(db.test) + {
            SERVICE_NAME: "requests-core",
            SERVICE_NAMESPACE: "dev",
            JAEGER_COLLECTOR_HOST: "http://jaeger:14268/api/traces",
            EXPORTER_TYPE: "jaeger",
            ENVIRONMENT: "development",
            PROMETHEUS_HOST: ":9100",
        },
    },
    "cabinet-auth": {
        env_file: "cabinet-authentication-service/.env",
        port: ["PORT", 50051], // TODO: set PORT env name, value
        env: db_env(db.test) + common_env("cabinet-auth") + {
            REDIS_DB_HOST: "localhost",
            REDIS_DB_PORT: "6379",
            REDIS_DB_NUMBER: "0",
            REDIS_DB_NAME: "a",
            REDIS_MASTER_NAME: "",
            REDIS_CONNECTION_TYPE: "regular",
        },
    },
    "client-auth": {
        env_file: "clients-authentication/.env",
        port: ["GRPC_PORT", 50051], // TODO: set PORT env value
        env: db_env(db.test) + common_env("client-auth") + {
            ENVIRONMENT: "dev",
            REDIS_DB_HOST: "localhost",
            REDIS_DB_PORT: "6379",
            REDIS_DB_NUMBER: "0",
            REDIS_DB_NAME: "a",
            REDIS_MASTER_NAME: "",
            REDIS_CONNECTION_TYPE: "regular",
        },
    },
    "profile": {
        env_file: "profile/.env",
        port: ["GRPC_PORT", 50053], // TODO: set PORT env name, value
        env: db_env(db.test) + common_env("profile") + {},
    },
    "notification-dispatcher-publisher": {
        env_file: "notification-dispatcher/.env.publisher",
        port: ["PORT", 45454], // TODO: set PORT env name
        env: {
            EVENT_BUS_RABBITMQ_HOST: "localhost",
            EVENT_BUS_RABBITMQ_PORT: 5672,
            EVENT_BUS_RABBITMQ_USER: "user",
            EVENT_BUS_RABBITMQ_PASS: "pass",
        } +
        // unused
        db_env(db.test) + common_env("notification-dispatcher-publisher") + {
            NOTIFY_QUEUE_RABBITMQ_HOST: "localhost",
            NOTIFY_QUEUE_RABBITMQ_PORT: 5672,
            NOTIFY_QUEUE_RABBITMQ_USER: "user",
            NOTIFY_QUEUE_RABBITMQ_PASS: "pass",
            REDIS_DB_HOST: "localhost",
            REDIS_DB_PORT: 6379,
            REDIS_DB_NUMBER: 1,
            REDIS_DB_NAME: 1,
            REDIS_CONNECTION_TYPE: "regular",
            CRON_PERIOD: 1,
            DELAYED_NOTIFICATION_CALCULATION_UPDATE: 60,
        },
    },
    "notification-dispatcher": {
        env_file: "notification-dispatcher/.env",
        port: ["PORT", 50051], // TODO: set PORT env name
        env: db_env(db.test) + common_env("notification-dispatcher") + {
            EVENT_BUS_RABBITMQ_HOST: "localhost",
            EVENT_BUS_RABBITMQ_PORT: 5672,
            EVENT_BUS_RABBITMQ_USER: "user",
            EVENT_BUS_RABBITMQ_PASS: "pass",
            NOTIFY_QUEUE_RABBITMQ_HOST: "localhost",
            NOTIFY_QUEUE_RABBITMQ_PORT: 5672,
            NOTIFY_QUEUE_RABBITMQ_USER: "user",
            NOTIFY_QUEUE_RABBITMQ_PASS: "pass",
            REDIS_DB_HOST: "localhost",
            REDIS_DB_PORT: 6379,
            REDIS_DB_NUMBER: 1,
            REDIS_DB_NAME: 1,
            REDIS_CONNECTION_TYPE: "regular",
            CRON_PERIOD: 1,
            DELAYED_NOTIFICATION_CALCULATION_UPDATE: 60,
        },
    },
    "objects-core": {
        env_file: "objects-core/.env",
        port: ["PORT", 50061],
        env: db_env(db.test) + {
            JAEGER_COLLECTOR_HOST: "http://jaeger:14268/api/traces",
            ENVIRONMENT: "dev",
            HOST: "0.0.0.0",
            DEBUG: "true",
        },
    },
    "finance": {
        env_file: "finance/.env",
        port: ["GRPC_PORT", 50057],
        env: db_env(db.prod) + common_env("finance") + {
            MONGO_DB_NAME: "test",
            MONGO_DB_HOST: "localhost",
            MONGO_DB_PORT: 27017,
            MONGO_DB_USER: "user",
            MONGO_DB_PASS: "pass",
            MONGO_DB_AUTH: "admin",
            MONGO_COLLECTION_NAME: "distributions",
        },
    },
    // "public-api": {
    //     env_file: "public-api/.env",
    //     port: ["API_BASE_URL", ":8881"],
    //     env: db_env(db.prod) + {
    //         ENVIRONMENT: "development",
    //         KVADO_URL: "a",
    //         SECRET_KEY: "b",
    //         REQUEST_CORE_SERVICE: "c",
    //         FINANCE_SERVICE: "localhost:50057",
    //         REAL_ESTATE_SERVICE: "d",
    //         AUTH_SERVICE: "e",
    //         ADS_SERVICE: "f",
    //         STORAGE_SERVICE: "g",
    //         REQUEST_SERVICE: "localhost:50054",
    //         STORAGE_ENDPOINT: "localhost:50064",
    //         STORAGE_ACCESS_KEY: "i",
    //         STORAGE_SECRET: "j",
    //         STORAGE_USE_SSL: "k",
    //         BUCKET_NAME: "lmn",
    //     }
    // },
    "reports-manager": {
        env_file: "reports-manager/.env.manager",
        port: ["GRPC_PORT", 50057],
        env: db_env(db.prod) + rabbitmq_env + common_env("reports-manager-manager") + {
            BUCKET_NAME: "reports",

            HOST: "0.0.0.0",
            GRPC_HOST: "0.0.0.0",

            MONGO_REPORTS_DB_NAME: "reports",
            MONGO_REPORTS_DB_HOST: "localhost",
            MONGO_REPORTS_DB_PORT: 27017,
            MONGO_REPORTS_DB_USER: "user",
            MONGO_REPORTS_DB_PASS: "pass",
            MONGO_REPORTS_DB_AUTH: "admin",
            MONGO_REPORTS_DB_COLLECTION: "reports",

            MONGO_PAYMENTS_DB_NAME: "reports",
            MONGO_PAYMENTS_DB_HOST: "localhost",
            MONGO_PAYMENTS_DB_PORT: 27017,
            MONGO_PAYMENTS_DB_USER: "user",
            MONGO_PAYMENTS_DB_PASS: "pass",
            MONGO_PAYMENTS_DB_AUTH: "admin",
            MONGO_PAYMENTS_DB_COLLECTION: "reports",

            STORAGE_ACCESS_KEY_ID: "user",
            STORAGE_ENDPOINT: "localhost:9000",
            STORAGE_SECRET_ACCESS_KEY: "password",
            STORAGE_USE_SSL: "false",

            VOTES_SERVER: "placeholder",
            FINANCE_SERVER: "finance:50051",
        },
    },
    "reports-creator": {
        env_file: "reports-manager/.env.creator",
        port: ["GRPC_PORT", 50058],
        env: db_env(db.prod) + rabbitmq_env + common_env("reports-manager-creator") + {
            BUCKET_NAME: "reports",

            HOST: "0.0.0.0",
            GRPC_HOST: "0.0.0.0",

            MONGO_REPORTS_DB_NAME: "reports",
            MONGO_REPORTS_DB_HOST: "localhost",
            MONGO_REPORTS_DB_PORT: 27017,
            MONGO_REPORTS_DB_USER: "user",
            MONGO_REPORTS_DB_PASS: "pass",
            MONGO_REPORTS_DB_AUTH: "admin",
            MONGO_REPORTS_DB_COLLECTION: "reports",

            MONGO_PAYMENTS_DB_NAME: "reports",
            MONGO_PAYMENTS_DB_HOST: "localhost",
            MONGO_PAYMENTS_DB_PORT: 27017,
            MONGO_PAYMENTS_DB_USER: "user",
            MONGO_PAYMENTS_DB_PASS: "pass",
            MONGO_PAYMENTS_DB_AUTH: "admin",
            MONGO_PAYMENTS_DB_COLLECTION: "reports",

            STORAGE_ACCESS_KEY_ID: "user",
            STORAGE_ENDPOINT: "localhost:9000",
            STORAGE_SECRET_ACCESS_KEY: "password",
            STORAGE_USE_SSL: "false",

            VOTES_SERVER: "placeholder",
            FINANCE_SERVER: "finance:50051",
        },
    },
    "device-registration": {
        port: ["GRPC_PORT", 50059],
        env: db_env(db.geo) + common_env("device-registration") + {
            DEBUG: "true",
            HOST: "0.0.0.0",
            CABINET_AUTH_SERVICE: "http://localhost:50052",
            CLIENT_AUTH_SERVICE: "client_auth:50051",
            PROFILE_SERVICE: "localhost:50053",
        },
    },
    "requests": {
        env_file: "requests/.env",
        port: ["GRPC_PORT", 50054],
        env: db_env(db.prod) + common_env("requests") + {
            CABINET_AUTH_SERVICE: "1",
            STORAGE_SERVICE: "2",
            REQUESTS_CORE_SERVICE: "localhost:50055",
            CLIENTS_PAID_SERVICE: "localhost:50064",
            WSS_SERVICE: "5",
            CLIENT_AUTH_SERVICE: "localhost:50051",
            REAL_ESTATE_SERVICE: "localhost:50057",
            CLIENTS_SERVICE: "localhost:50055",
        },
    },
    "clients2": {
        env_file: "clients2/.env",
        port: ["GRPC_PORT", 50055],
        env: db_env(db.prod) + common_env("clients2") + {},
    },
    "real-estate": {
        env_file: "real-estate/.env",
        port: ["GRPC_PORT", 50057],
        env: db_env(db.prod) + common_env("real-estate") + {},
    },
    "entrypoint-clients": {
        env_file: "entrypoint-clients/.env",
        port: ["PORT", 3002],
        env: db_env(db.test) + common_env("entrypoint-clients") + {
            HOST: "0.0.0.0",
            MASTER_AUTHENTICATION_SERVICE: "localhost:50051",
            MASTER_MENU_SERVICE: "2",
            VERSION_CHECK_SERVICE: "3",
            PROFILE_SERVICE: "4",
            PAID_SERVICE: "5",
            DEVICE_REGISTRATION_SERVICE: "6",
            GEOLOCATION_SERVICE: "7",
            PUSH_HISTORY_SERVICE: "localhost:50063",
            MASTER_REQUESTS_SERVICE_V1: "9",
            MASTER_REQUESTS_SERVICE_V2: "localhost:50054",
        },
    },
    "entrypoint-residents": {
        env_file: "entrypoint-residents/.env",
        port: ["PORT", 3001],
        env: db_env(db.test) + common_env("entrypoint-residents") + {
            HOST: "0.0.0.0",
            ENTRYPOINT_HOST: "1",
            // STORAGE_ACCESS_KEY_ID=user
            // STORAGE_ENDPOINT=localhost:9000
            // STORAGE_SECRET_ACCESS_KEY=password
            // STORAGE_USE_SSL=false
            // VOTES_SERVER=placeholder
            CABINET_AUTHENTICATION_SERVICE: "http://localhost:50052",
            APARTMENT_SERVICE: "2",
            APP_RATING_SERVICE: "3",
            APP_VERSION_SERVICE: "4",
            APPEALS_SERVICE: "5",
            VOTE_SERVICE: "6",
            DADATA_PROXY_SERVICE: "7",
            DEVICE_REGISTRATION_SERVICE: "localhost:50059",
            HOUSE_SERVICE: "9",
            MARKETPLACE_ENTRYPOINT: "10",
            MARKETPLACE_SERVICE: "11",
            MENU_SERVICE: "12",
            NEWS_SERVICE: "localhost:50051",
            METERS_SERVICE: "13",
            ORGANIZATION_SERVICE: "14",
            PAID_SERVICES_SERVICE: "localhost:50060",
            PAYMENT_HISTORY_SERVICE: "16",
            PROFILE_SERVICE: "localhost:50053",
            PUSH_HISTORY_SERVICE: "18",
            RECEIPTS_SERVICE: "19",
            REQUESTS_SERVICE: "20",
            SETTINGS_SERVICE: "21",
            STORAGE_SERVICE: "22",
            NEW_RECEIPTS_SERVICE: "23",
            DOCUMENTS_SERVICE: "24",
        },
    },
    "paid-services-kvado-api": {
        env_file: "paid-services-kvado-api/.env",
        port: ["GRPC_PORT", 50060],
        env: db_env(db.test) + common_env("paid-services-kvado-api") + {
            ACQUIRING_HOST: "1",
        },
    },
    "paid-services": {
        env_file: "paid-services/.env",
        port: ["GRPC_PORT", 50064],
        env: db_env(db.test) + common_env("paid-services") + {
            CATALOG_SERVICES_SERVICE: "1",
            AUTHENTICATION_SERVICE: "localhost:50051",
        },
    },
    "counters-requester": {
        env_file: "counters-requester/.env",
        port: ["_", ""],
        env: db_env(db.test)
            + rabbitmq_env
            + common_env("counters-requester")
            + {
                PING_HOST: ":1323",
                SCHEDULE_UPDATE_INTERVAL: "2h",
            },
    },
    "push-history": {
        env_file: "push-history/.env",
        port: ["GRPC_PORT", 50063],
        env: db_env(db.test) + common_env("push-history")
            + {
                PUSH_HISTORY_DB_HOST: db.test.host,
                PUSH_HISTORY_DB_PORT: db.test.port,
                PUSH_HISTORY_DB_USER: db.test.user,
                PUSH_HISTORY_DB_PASS: db.test.pass,
                PUSH_HISTORY_DB_NAME: db.test.name,
                CLIENTS_AUTHENTICATION_SERVICE: "localhost:50051",
                RESIDENTS_AUTHENTICATION_SERVICE: "localhost:50051",
                DEVICE_REGISTRATION_SERVICE: "localhost:50059",
            },
    },
    "storage": {
        env_file: "storage/.env",
        port: ["STORAGE_PORT", 50064],
        env: db_env(db.prod) + common_env("storage") + {
            STORAGE_ACCESS_KEY_ID: "user",
            STORAGE_ENDPOINT: "localhost:9000",
            STORAGE_SECRET_ACCESS_KEY: "password",
            STORAGE_USE_SSL: "false",
            BUCKET_NAME: "lmn"
        }
    },
};

local items(obj) = [[k, obj[k]] for k in std.objectFields(obj)];

local dotenv_filename(service, srvc) =
    if std.objectHas(srvc, "env_file") then
        srvc.env_file
    else
        service + "/.env";

local formatDotenv(e) = std.join("\n", ["%s=%s" % kv for kv in items(e)]);

local dotenv(srvc) = formatDotenv(
    {[srvc["port"][0]]: srvc["port"][1]} +
    srvc["env"]
);

{
    [dotenv_filename(service, services[service])]: dotenv(services[service])
    for service in std.objectFields(services)
}</code></pre><p><code>mani.yaml</code></p><pre><code data-lang="yaml">projects:
  work:
    path: .

  GoCodeConv:                 {url: "git@gitlab.private.kvado.ru:ps/GoCodeConv.git"}
  appeals:                    {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/appeals.git"}
  entrypoint-residents-docs:  {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/cabinet-mobile-api-docs.git"}
  counters-requester:         {url: "git@gitlab.private.kvado.ru:kvado-api/counters-requester.git"}
  debuql:                     {url: "git@gitlab.private.kvado.ru:poletanskiy/debuql.git"}
  device-registration:        {url: "git@gitlab.private.kvado.ru:clients-api/device-registration.git"}
  entrypoint-clients:         {url: "git@gitlab.private.kvado.ru:clients-api/entry-point.git"}
  entrypoint-residents:       {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/cabinet-mobile-api-entry-point.git"}
  events-protofiles:          {url: "git@gitlab.private.kvado.ru:kvado-event-bus/events-protofiles.git"}
  finance:                    {url: "git@gitlab.private.kvado.ru:kvado-api/finance.git"}
  gendoc:                     {url: "git@gitlab.private.kvado.ru:poletanskiy/gendoc.git"}
  go-client:                  {url: "git@gitlab.private.kvado.ru:kvado-event-bus/go-client.git"}
  import:                     {url: "git@gitlab.private.kvado.ru:kvado-api/import.git"}
  import-docs:                {url: "git@gitlab.private.kvado.ru:kvado-api/import-docs.git"}
  logs:                       {url: "git@gitlab.private.kvado.ru:poletanskiy/logs.git"}
  menu:                       {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/menu.git"}
  meters:                     {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/meters.git"}
  news:                       {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/news.git"}
  notification-dispatcher:    {url: "git@gitlab.private.kvado.ru:kvado-api/notification-dispatcher.git"}
  notifications-settings:     {url: "git@gitlab.private.kvado.ru:kvado-api/notifications-settings.git"}
  objects-core:               {url: "git@gitlab.private.kvado.ru:kvado-api/objects-core.git"}
  organization:               {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/organization.git"}
  reports-manager:            {url: "git@gitlab.private.kvado.ru:kvado/reports-manager.git"}
  poletanskiy/requests:       {url: "git@gitlab.private.kvado.ru:poletanskiy/requests.git"}
  service-pattern:            {url: "ssh://git@gitlab.private.kvado.ru/golib/service-pattern.git"}
  services-develop-docs:      {url: "git@gitlab.private.kvado.ru:ps/services-develop-docs.git"}
  storage:                    {url: "git@gitlab.private.kvado.ru:kvado/storage.git"}
  tg_bot:                     {url: "git@gitlab.private.kvado.ru:poletanskiy/tg_bot.git"}
  tools:                      {url: "git@gitlab.private.kvado.ru:golib/tools.git"}
  votes:                      {url: "git@gitlab.private.kvado.ru:kvado-api/votes.git"}
  settings:                   {url: "git@gitlab.private.kvado.ru:kvado-api-v2/settings.git"}
  profile:                    {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/profile"}
  notifyer:                   {url: "git@gitlab.private.kvado.ru:kvado-api/notifyer.git"}
  paid-services:              {url: "git@gitlab.private.kvado.ru:clients-api/paid-services.git"}
  paid-services-kvado-api:    {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/paid-services.git"}
  authentication:             {url: "git@gitlab.private.kvado.ru:clients-api/authentication.git"}
  requests:                   {url: "git@gitlab.private.kvado.ru:clients-api/requests.git"}
  payments-history:           {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/payments-history.git"}
  marketplace:                {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/marketplace.git"}
  house:                      {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/house.git"}
  apartment:                  {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/apartment.git"}
  app-version-check:          {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/app-version-check.git"}
  go-requests:                {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/go-requests.git"}
  clients-profile:            {url: "git@gitlab.private.kvado.ru:clients-api/profile.git"}
  receipts:                   {url: "git@gitlab.private.kvado.ru:kvado-api/mobile/receipts.git"}
  cashbox:                    {url: "git@gitlab.private.kvado.ru:kvado/cashbox.git"}
  acquiring-service:          {url: "git@gitlab.private.kvado.ru:kvado/acquiring-service.git"}
  db-viewer:                  {url: "git@gitlab.private.kvado.ru:kvado/db-viewer.git"}
  url-shortener:              {url: "git@gitlab.private.kvado.ru:kvado/url-shortener.git"}
  htmltopdf:                  {url: "git@gitlab.private.kvado.ru:kvado/htmltopdf.git"}
  app-rating-service:         {url: "git@gitlab.private.kvado.ru:kvado/app-rating-service.git"}
  manager-golang:             {url: "git@gitlab.private.kvado.ru:kvado/manager-golang.git"}
  distribution-go:            {url: "git@gitlab.private.kvado.ru:kvado/distribution-go.git"}
  dadata-proxy:               {url: "git@gitlab.private.kvado.ru:kvado/dadata-proxy.git"}
  requests-core:              {url: "git@gitlab.private.kvado.ru:kvado-api/requests-core.git"}
  penalties-service:          {url: "git@gitlab.private.kvado.ru:kvado-api/penalties-service.git"}
  go-requests-kvado-api:      {url: "git@gitlab.private.kvado.ru:kvado-api/go-requests.git"}
  accruals-sender:            {url: "git@gitlab.private.kvado.ru:kvado-api/accruals-sender.git"}
  push-history:               {url: "git@gitlab.private.kvado.ru:kvado-api/push-history.git"}
  push-sender:                {url: "git@gitlab.private.kvado.ru:kvado-api/push-sender.git"}
  clients-core:               {url: "git@gitlab.private.kvado.ru:kvado-api/clients-core.git"}
  mobile-app-common-settings: {url: "git@gitlab.private.kvado.ru:kvado-api/mobile-app-common-settings.git"}
  catalog-service:            {url: "git@gitlab.private.kvado.ru:kvado-api/catalog-services.git"}
  notify-queue:               {url: "git@gitlab.private.kvado.ru:golib/notify-queue.git"}
  manager:                    {url: "https://gitlab.private.kvado.ru/kvado/manager"}
  reports-client-php:         {url: "https://gitlab.private.kvado.ru/kvado-api/reports-client-php"}
  task-bus-client:            {url: "git@gitlab.private.kvado.ru:kvado-task-bus/go-client.git"}
  wss-server:                 {url: "git@gitlab.private.kvado.ru:kvado/wss-server.git"}
  public-api:                 {url: "git@gitlab.private.kvado.ru:kvado-api/public-api.git"}
  real-estate:                {url: "git@gitlab.private.kvado.ru:kvado-api/real-estate"}
  clients2:                   {url: "git@gitlab.private.kvado.ru:kvado-api/clients.git"}

tasks:
  hello:
    desc: Print Hello World
    cmd: echo "Hello World"
  branches:
    desc: Print all branches
    cmd: git branch -a
  unused:
    cmd: staticcheck --unused.whole-program=true ./... 2>/dev/null | rg U1001
  pull:
    cmd: git pull</code></pre>
    </article>

    <footer>
    <p>
        Sistine is a project by
        <a href="https://thesephist.com/" target="_blank">Linus</a>
        built with
        <a href="https://dotink.co/" target="_blank">Ink</a>.
    </p>
</footer>

</main>

<script src="/js/main.js"></script>

</body>
