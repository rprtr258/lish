#article

Как вы могли заметить с каждой статьей по теории категорий мы изучаем вещи все более и более абстрактные и эта статья не исключение. Раньше мы говорили про функторы, которые напомню являются стрелками между категориями, теперь же мы изучим естественные преобразования, которые являются стрелками между функторами. Кажется, что начинается какой-то бред, потому как функторы переводят стрелки и обьекты в стрелки и обьекты. Теперь же мы переводим эти стрелки в другие такие стрелки. Почему бы не продолжить и не определить стрелки между естественными преобразованиями, стрелки между стрелками между естественными преобразованиями и так далее? На самом же деле естественные преобразования вернут нас к исходным стрелкам внутри категории и стрелкой между естественными преобразованиями будет что-то наподобие функтора. Надеюсь это краткое введение дало какое-то представление о том, что такое естественное преобразование и сейчас мы разберем его подробнее, не зря же для этого выделена целая статья!

d-categories, убрать про бред про стрелки между стрелками между стрелками

# **Prerequisites**

Критически важным здесь является понятие функтора, о которых я писал во второй статье по теории категорий.

# **Определение**

Пусть у нас есть две категории **C** и **D** и два функтора F, G:**C**→**D**. Естественное преобразование дает способ «сравнить» эти два функтора. Сделать мы это хотим с помощью стрелок в категории **D**, которые мы найдем для каждого обьекта X в категории **C**. Эта стрелка будет иметь вид \phi_X:F(X)→G(X), то есть переводить результат действия одного функтора на этом обьекте в результат другого функтора, тем самым сопоставляя их. Формально: естественным преобразованием между функторами F, G:**C**→**D** называется семейство стрелок \varphi = \{\phi_X\}_{X\in **C**} таких, что коммутируют все диаграммы следующего вида:

![https://sun9-60.userapi.com/impf/qCe8ttUwoiZSCZOaOhOQYEFQpZUvEsqO5a26ug/PzgGQZHvFtA.jpg?size=807x652&quality=96&sign=64ed9264a9814da56c5ca955e9e849cf&type=album](https://sun9-60.userapi.com/impf/qCe8ttUwoiZSCZOaOhOQYEFQpZUvEsqO5a26ug/PzgGQZHvFtA.jpg?size=807x652&quality=96&sign=64ed9264a9814da56c5ca955e9e849cf&type=album)

Так как это семейство стрелок корректно(т.е. согласно диаграмме) сопоставляет функторы, оно называется естественным преобразованием (natural transformation). Кроме согласования обектов-результатов функторов F и G, естественное преобразование также корректно сопоставляет стрелки, так как ровно это и изображено на диаграмме.

Также про «стрелки между стрелками между стрелками…». Функторы мы определяли между категориями и они сопоставляли стрелки со стрелками. Грубо говоря: «функторы — стрелки между стрелками». Естественные преобразования это «стрелки между функторами», т.е. «стрелки между стрелками между стрелками». Однако, как оказалось, естественные преобразования это просто семейство стрелок в исходной категории, поэтому дальше идти большого смысла нет.

# **Примеры естественных преобразований**

Начнем с простого: пусть **F** и **G** это константные функторы, которые переводят все обьекты в **F**(X), **G**(X) и все стрелки в 1_{**F**(X)}, 1_{**G**(X)} соответственно. Тогда очевидно, что стрелкой между F и G должна быть стрелка из f:F(X)→G(X), что и будет естественным преобразованием f_X:F→G. Эта стрелка одна и та же для всех обьектов, поэтому согласно формальному определению f_X = f.

Возьмем теперь функторы List(1 + x\times List(x)) и Maybe(1 + x). Функция, дающая начало списка, будет естественным преобразованием:head(1) = 1head((x, y)) = x, y\in List(x)

Доказательство свойства натуральности:head List(f) = Maybe(f) head …

length:List→Const(Int) тоже естественное преобразование.

Y:(R=>)→**F**, где F — произвольный функтор. Суперважное семейство естественных преобразований. Оно связано с чисто категорным результатом под названием лемма Йонеды(Yoneda's lemma), которая говорит, что естественные преобразования в этом семействе находятся в биективном соответствии с F(R). Например, пусть R = 1, F(X) = Maybe(X) = 1 + X. Тогда (R=>)(X) = (1=>X) — все «элементы» X. Есть два естественных преобразования: глупое(dumb) и очевидное(obvious):dumb(X)(f) = 1obvious(X)(f) = fЧто соответсвует элементам F(1) = 1 + 1, которых в точности 2. Мы вернемся к этой лемме далее, чтобы обсудить подробнее.

На самом деле любое отображение из F(X) в G(X) не зависящее от X будет естественным преобразованием.

# **Категория функторов**

Имея стрелки между функторами логично задаться вопросом: составляют ли функторы с естественными преобразованиями категорию? Оказывается, что да! Для двух категорий **C** и **D** образуем категорию **D^C** с обьектами — функторами из **C** в **D** и стрелками — естественными преобразованиями. Композицией между естественными преобразованиями логично брать композиции соответствующих стрелок. Единичными естественными преобразованиями будут очевидно семейства единичных стрелок. На диаграммах естественные преобразования изображаются двойной стрелкой:

![https://sun9-42.userapi.com/impf/c855624/v855624701/1ee951/PohWa56rIOI.jpg?size=224x146&quality=96&proxy=1&sign=8c037feb34781bcde64c0ddf3876b2f7&type=album](https://sun9-42.userapi.com/impf/c855624/v855624701/1ee951/PohWa56rIOI.jpg?size=224x146&quality=96&proxy=1&sign=8c037feb34781bcde64c0ddf3876b2f7&type=album)

Иногда эту категорию могут обозначать как **Fun(C, D)** или **[C, D]**, но я использую то же обозначение, которое было для exponential-ов так как это действительно exponential в категории **Cat**. На самом деле **Cat** это декартово замкнутая категория так как ее обьекты — локально малые категории, то есть множества, и в ней есть произведения, которые строятся по аналогии с декартовым произведением, но с добавлением стрелок.

# **2-Categories**

Если мы будем называть стрелки в категории 0-стрелками, тогда логично называть функторы 1-стрелками и естественные преобразования 2-стрелками. Категория с 0-, 1- и 2-стрелками называется 2-категорией. Пример 2-категории — **Cat**.

![https://sun9-1.userapi.com/impf/c855624/v855624769/1e9b57/Ntapl5H-Cn4.jpg?size=317x173&quality=96&proxy=1&sign=471fd3d2c16e3567305ce5dbe9ae3adc&type=album](https://sun9-1.userapi.com/impf/c855624/v855624769/1e9b57/Ntapl5H-Cn4.jpg?size=317x173&quality=96&proxy=1&sign=471fd3d2c16e3567305ce5dbe9ae3adc&type=album)

# **Моноид**

# **Моноидальная категория**

# **Примеры моноидов в категориях**

Sets — моноидальная категория относительно product и относительно coproduct

Vec — моноидальная категория относительно тензорного произведения

![https://sun9-11.userapi.com/impf/c854220/v854220868/1b8dc1/Uo2YbR3rUdA.jpg?size=545x598&quality=96&proxy=1&sign=392312954e11806016efc36c8131cf23&type=album](https://sun9-11.userapi.com/impf/c854220/v854220868/1b8dc1/Uo2YbR3rUdA.jpg?size=545x598&quality=96&proxy=1&sign=392312954e11806016efc36c8131cf23&type=album)

# **Категория эндофункторов**

Является примером моноидальной категории. Также она отличается от предыдущих примеров тем, что она построено только на категорных понятиях и моноид в ней имеет важное значение в приложениях и теории.

# **Монада**

Да, та самая монада из Haskell, хотя она по моему мнению должна быть во всех языках. Хотя мы так долго добирались до нее, тем не менее польза от нее неоценима, хотя здесь мы ее подробно разбирать не будем, только пару примеров.

![https://sun9-51.userapi.com/impf/c854220/v854220868/1b8ce0/iBdnew7MaRg.jpg?size=625x553&quality=96&proxy=1&sign=7ff6d1f5de5f2eb47ffac8b0b8d1f305&type=album](https://sun9-51.userapi.com/impf/c854220/v854220868/1b8ce0/iBdnew7MaRg.jpg?size=625x553&quality=96&proxy=1&sign=7ff6d1f5de5f2eb47ffac8b0b8d1f305&type=album)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%201.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%202.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%203.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%204.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%205.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%206.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%207.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%208.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%209.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%2010.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%2011.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%2012.png)

![](data/static/old/someday_maybe/articles/Естественные%20преобразования%20или%20стрелки%20между%20стрелками%20(со%20вкусом%20монад)/Untitled%2013.png)

Собственно определение на картинке. Определим монаду формально, введем обозначения и сразу к примерам.

![https://sun9-29.userapi.com/impf/c854220/v854220868/1b8dd1/VtX99EtpS8U.jpg?size=526x299&quality=96&proxy=1&sign=2d6939faa7a0a2c300d17eef4b346700&type=album](https://sun9-29.userapi.com/impf/c854220/v854220868/1b8dd1/VtX99EtpS8U.jpg?size=526x299&quality=96&proxy=1&sign=2d6939faa7a0a2c300d17eef4b346700&type=album)

# **Примеры монад(не из программирования)**

Про монады из программирования, то есть из категории лямбда-выражений я планирую сделать отдельную статью и здесь их не будет. Также эта серия скорее про теорию категорий с примерами, так что рассмотрим монады, которые бывают не только в вашем любимом функциональном языке.

# **Const product & Const coproduct monad**

Сначала рассмотрим несколько общий пример монад, из которых можно указывая конкретный параметр вывести конкретные примеры монад.

**xB**: A → A x B**+B**: A → A + B

# **Maybe monad**

В категории с терминальным обьектом возьмем const-product монаду с произведением на этот терминальный обьект:

**Maybe**: T → T + 1

# **List monad**

**List**: T → T + T x **List**(T)

# **Kleisli categories**

[https://math.stackexchange.com/questions/174475/kleisli-category-examples/175105](https://math.stackexchange.com/questions/174475/kleisli-category-examples/175105)

[https://stackoverflow.com/questions/3870088/a-monad-%20is-just-a-monoid-in-the-category-of-endofunctors-%20whats-the-problem](https://stackoverflow.com/questions/3870088/a-monad-%20is-just-a-monoid-in-the-category-of-endofunctors-%20whats-the-problem)

[https://mathoverflow.net/questions/328513/big-list-of-comonads?stw=2](https://mathoverflow.net/questions/328513/big-list-of-comonads?stw=2)

[https://en.wikipedia.org/wiki/Monad_(category_theory](https://en.wikipedia.org/wiki/Monad_(category_theory))

[https://en.wikipedia.org/wiki/Monad_(functional_programming](https://en.wikipedia.org/wiki/Monad_(functional_programming))

[https://vpatryshev.blogspot.com/2011/05/monad-genome-part-1.html](https://vpatryshev.blogspot.com/2011/05/monad-genome-part-1.html)

[A Neighborhood of Infinity](http://blog.sigfpe.com/2006/10/monads-field-guide.html)

[[data/static/old/someday_maybe/articles/Естественные преобразования или стрелки между стрелками (со вкусом монад)/monads.pdf]]

[A Neighborhood of Infinity](http://blog.sigfpe.com/2008/05/you-could-have-defined-natural.html)

[A Neighborhood of Infinity](http://blog.sigfpe.com/2006/08/you-could-have-invented-monads-and.html)

[A Neighborhood of Infinity](http://blog.sigfpe.com/2009/12/where-do-monads-come-from.html)

[A Neighborhood of Infinity](http://blog.sigfpe.com/2009/05/trace-diagrams-with-monads.html)